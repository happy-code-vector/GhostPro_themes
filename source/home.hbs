{{!< default}}
{{!-- The tag above means: insert everything in this file into the body of the default.hbs template --}}

{{!-- Magic link welcome handler --}}
<script>
(function() {
    // Wait for global auth to be ready
    function checkAuthStatus() {
        if (window.pmAuth && !window.pmAuth.isLoading) {
            // Check if this is a fresh sign-in
            const wasJustSignedIn = sessionStorage.getItem('pm_just_signed_in');
            if (window.pmAuth.isAuthenticated && wasJustSignedIn) {
                sessionStorage.removeItem('pm_just_signed_in');
                // Show welcome notification
                showWelcomeToast(`Welcome back, ${window.pmAuth.user.email}! You are now signed in.`);
            }
        } else {
            setTimeout(checkAuthStatus, 100);
        }
    }
    
    function showWelcomeToast(message) {
        const toast = document.createElement('div');
        toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#27ae60;color:#fff;padding:16px 24px;border-radius:8px;z-index:10000;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);max-width:300px;';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 5000);
    }
    
    checkAuthStatus();
})();
</script>

{{> "components/header" headerStyle=@custom.header_style}}

{{#match @custom.header_style "!=" "Highlight"}}
    {{> "components/featured" showFeatured=@custom.show_featured_posts limit=4}}
{{/match}}

{{> "components/cta"}}

{{> "components/post-list" feed="home" postFeedStyle=@custom.post_feed_style showTitle=true showSidebar=@custom.show_publication_info_sidebar}}